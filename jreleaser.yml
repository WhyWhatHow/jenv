# 1. Matrix ä¿æŒä¸å˜
matrix:
  rows:
    - { goos: darwin,  goarch: arm64, platform: osx-aarch_64 }
    - { goos: darwin,  goarch: amd64, platform: osx-x86_64 }
    - { goos: linux,   goarch: arm64, platform: linux-aarch_64 }
    - { goos: linux,   goarch: amd64, platform: linux-x86_64 }
    - { goos: windows, goarch: arm64, platform: windows-aarch_64 }
    - { goos: windows, goarch: amd64, platform: windows-x86_64 }

project:
  name: jenv
  description: Java Environment Manager
  # 2. æ–°å¢ longDescriptionï¼ŒWinget å¼ºçƒˆå»ºè®®è¦æœ‰é•¿æè¿°
  longDescription: |
    jenv is a command line tool to manage Java versions on Windows.
    It is a lightweight alternative written in Go, allowing easy switching between JDKs.
  copyright: Copyright (c) 2025 WhyWhatHow
  authors:
    - WhyWhatHow
  license: Apache-2.0
  links:
    homepage: https://github.com/WhyWhatHow/jenv
    # 3. å»ºè®®è¡¥å…… bugTrackerï¼ŒWinget ä¼šç”¨åˆ°
    bugTracker: https://github.com/WhyWhatHow/jenv/issues

release:
  github:
    owner: WhyWhatHow
    name: jenv
    overwrite: true
    draft: false
    discussionCategoryName: Announcements
    changelog:
      formatted: ALWAYS
      format: '- {{commitShortHash}} {{commitTitle}}'
      contributors:
        format: '- {{contributorName}}{{#contributorUsernameAsLink}} ({{.}}){{/contributorUsernameAsLink}}'
      labelers:
        - label: 'feature'
          title: 'feat:'
        - label: 'issue'
          title: 'fix:'
        - label: 'task'
          title: 'chore:'
      categories:
        - title: 'â­ï¸ Features'
          labels:
            - 'feature'
        - title: 'âœ… Issues'
          labels:
            - 'issue'
        - title: 'ğŸ›  Tasks'
          labels:
            - 'task'
      replacers:
        - search: 'feat: '
        - search: 'fix: '
        - search: 'chore: '

# 4. Hooks ä¿æŒä¸å˜ï¼Œç”¨äºç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶
hooks:
  script:
    before:
      - run: |
          echo "building ${GOOS}-${GOARCH}-${VERSION}"
          cd src 
          go mod download
          # ğŸ‘‡ ä¿®æ”¹è¿™é‡Œï¼šæ˜ç¡®åŠ ä¸Š /jenv.exe
          go build -ldflags "-X github.com/whywhathow/jenv/cmd.Version=${VERSION}" -o ../dist/${GOOS}-${GOARCH}/jenv.exe
        applyDefaultMatrix: true
        verbose: true
        environment:
          VERSION: "{{projectVersion}}"
          GOOS: "{{ matrix.goos }}"
          GOARCH: "{{ matrix.goarch }}"

# 5. Assemble ä¿æŒä¸å˜ (ç”Ÿæˆçš„ ZIP åŒ…ç»“æ„æ˜¯ bin/jenv.exe)
assemble:
  archive:
    jenv:
      active: ALWAYS
      formats: [ ZIP ]
      applyDefaultMatrix: true
      attachPlatform: true
      archiveName: "jenv-{{projectVersion}}-{{archivePlatform}}"
      fileSets:
        - input: "dist/{{ matrix.goos }}-{{ matrix.goarch }}"
          output: "bin"
          includes: [ "jenv{.exe,}" ]
        - input: "."
          output: "."
          includes: [ "LICENSE","README.md" ]

distributions:
  jenv:
    executable:
      name: jenv
      windowsExtension: exe

# 7. ã€æ–°å¢ã€‘Winget é…ç½®éƒ¨
packagers:
  winget:
    active: ALWAYS
    continueOnError: true
    # âš ï¸ è°ƒè¯•é˜¶æ®µè®¾ä¸º true
    skipPublishing: false
    
    # å¯¹åº” Winget ID: WhyWhatHow.jenv
    package:
      identifier: WhyWhatHow.jenv
    
    # å‘å¸ƒè€…ä¿¡æ¯
    publisher:
      name: WhyWhatHow

    # ğŸŸ¢ ä¿®æ­£ç‚¹ 1: è¿™é‡Œå¿…é¡»æ˜¯å­—ç¬¦ä¸²
    defaultLocale: "en-US"
    
    # ğŸŸ¢ ä¿®æ­£ç‚¹ 2: tags å¿…é¡»æ”¾åœ¨è¿™é‡Œ (winget çš„ç›´æ¥å­èŠ‚ç‚¹)
    tags:
      - java
      - version-manager
      - cli
      - go
    
    # å¾®è½¯å®˜æ–¹ä»“åº“é…ç½®
    repository:
      active: ALWAYS
      owner: microsoft
      name: winget-pkgs
      branch: HEAD
      
    installer:
      # å‘Šè¯‰ Winget è¿™æ˜¯ä¸€ä¸ª ZIP åŒ…
      type: ZIP
      # å®‰è£…ååœ¨ PATH ä¸­æ³¨å†Œçš„å‘½ä»¤
      command: jenv
  scoop:
    active: ALWAYS
    continueOnError: true
    skipPublishing: false
    repository:
      owner: ScoopInstaller
      name: Main
      branch: master
